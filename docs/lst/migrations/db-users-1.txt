--
-- Create database roles for server, bankgate and viewer
--
SELECT EXISTS (
    SELECT id FROM migrations WHERE id = :'MIGRATION_ID'
) as migrated \gset

\if :migrated
    \echo 'migration' :MIGRATION_ID 'already exists, skipping'
\else
    \echo 'migration' :MIGRATION_ID 'does not exist'

    \set SERVER_USER `echo $SERVER_USER`
    \set SERVER_PASSWORD `echo $SERVER_PASSWORD`
    \set BANKGATE_USER `echo $BANKGATE_USER`
    \set BANKGATE_PASSWORD `echo $BANKGATE_PASSWORD`
    \set VIEWER_USER `echo $VIEWER_USER`
    \set VIEWER_PASSWORD `echo $VIEWER_PASSWORD`
    \set DEALER_USER `echo $DEALER_USER`
    \set DEALER_PASSWORD `echo $DEALER_PASSWORD`

    \set exit_error false

    SELECT (:'SERVER_USER' = '') as is_not_empty \gset
    \if :is_not_empty
        \warn 'SERVER_USER is empty'
        \set exit_error true
    \endif

    SELECT (:'SERVER_PASSWORD' = '') as is_not_empty \gset
    \if :is_not_empty
        \warn 'SERVER_PASSWORD is empty'
        \set exit_error true
    \endif

    SELECT (:'BANKGATE_USER' = '') as is_not_empty \gset
    \if :is_not_empty
        \warn 'BANKGATE_USER is empty'
        \set exit_error true
    \endif
